openapi: 3.0.0
info:
  title: Anthropic Messages API
  version: 2024-01
  description: Access to Claude, a family of large language models optimized for helpfulness, harmlessness, and honesty.
servers:
  - url: https://api.anthropic.com
security:
  - ApiKeyAuth: []
paths:
  /v1/messages:
    post:
      operationId: messages.create
      summary: Create a message
      description: Send a conversation to Claude and receive a response. This is the primary endpoint for all Claude interactions.
      tags: [Messages]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMessageRequest'
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateMessageResponse'
        "400":
          description: Invalid request error
        "429":
          description: Rate limit error
        "529":
          description: API overloaded
  /v1/messages/count_tokens:
    post:
      operationId: messages.count_tokens
      summary: Count tokens
      description: Count the number of tokens in a message payload without running the model. Use for checking context limits or cost estimation.
      tags: [Messages]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CountTokensRequest'
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CountTokensResponse'
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
  schemas:
    Model:
      type: string
      enum:
        - claude-sonnet-4-20250514
        - claude-opus-4-20250514
        - claude-3-5-sonnet-20241022
        - claude-3-5-haiku-20241022
        - claude-3-opus-20240229
        - claude-3-haiku-20240307
    Role:
      type: string
      enum: [user, assistant]
    StopReason:
      type: string
      enum: [end_turn, max_tokens, stop_sequence, tool_use]
    TextBlock:
      type: object
      required: [type, text]
      properties:
        type:
          type: string
          enum: [text]
        text:
          type: string
    ImageSource:
      type: object
      required: [type, media_type, data]
      properties:
        type:
          type: string
          enum: [base64]
        media_type:
          type: string
          enum: [image/jpeg, image/png, image/gif, image/webp]
        data:
          type: string
          description: base64-encoded image data
    ImageBlock:
      type: object
      required: [type, source]
      properties:
        type:
          type: string
          enum: [image]
        source:
          $ref: '#/components/schemas/ImageSource'
    ToolUseBlock:
      type: object
      required: [type, id, name, input]
      properties:
        type:
          type: string
          enum: [tool_use]
        id:
          type: string
        name:
          type: string
        input:
          type: object
    ToolResultBlock:
      type: object
      required: [type, tool_use_id, content]
      properties:
        type:
          type: string
          enum: [tool_result]
        tool_use_id:
          type: string
        content:
          oneOf:
            - type: string
            - type: array
              items:
                $ref: '#/components/schemas/ContentBlock'
        is_error:
          type: boolean
    ContentBlock:
      oneOf:
        - $ref: '#/components/schemas/TextBlock'
        - $ref: '#/components/schemas/ImageBlock'
        - $ref: '#/components/schemas/ToolUseBlock'
        - $ref: '#/components/schemas/ToolResultBlock'
    Message:
      type: object
      required: [role, content]
      properties:
        role:
          $ref: '#/components/schemas/Role'
        content:
          oneOf:
            - type: string
            - type: array
              items:
                $ref: '#/components/schemas/ContentBlock'
    Tool:
      type: object
      required: [name, description, input_schema]
      properties:
        name:
          type: string
          pattern: ^[a-zA-Z0-9_-]+$
          minLength: 1
          maxLength: 64
        description:
          type: string
        input_schema:
          type: object
    Usage:
      type: object
      required: [input_tokens, output_tokens]
      properties:
        input_tokens:
          type: integer
        output_tokens:
          type: integer
    CreateMessageRequest:
      type: object
      required: [model, messages, max_tokens]
      properties:
        model:
          $ref: '#/components/schemas/Model'
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'
          minItems: 1
        max_tokens:
          type: integer
          minimum: 1
          maximum: 200000
        system:
          type: string
          description: System prompt for context/personality
        temperature:
          type: number
          minimum: 0.0
          maximum: 1.0
          default: 1.0
        top_p:
          type: number
          minimum: 0.0
          maximum: 1.0
        top_k:
          type: integer
          minimum: 1
        stop_sequences:
          type: array
          items:
            type: string
          maxItems: 8191
        stream:
          type: boolean
          default: false
          description: Set to true for streaming response via SSE
        tools:
          type: array
          items:
            $ref: '#/components/schemas/Tool'
        tool_choice:
          oneOf:
            - type: object
              properties:
                type:
                  type: string
                  enum: [auto]
            - type: object
              properties:
                type:
                  type: string
                  enum: [any]
            - type: object
              properties:
                type:
                  type: string
                  enum: [tool]
                name:
                  type: string
        metadata:
          type: object
          properties:
            user_id:
              type: string
    CreateMessageResponse:
      type: object
      required: [id, type, role, content, model, stop_reason, usage]
      properties:
        id:
          type: string
          pattern: ^msg_
        type:
          type: string
          enum: [message]
        role:
          type: string
          enum: [assistant]
        content:
          type: array
          items:
            $ref: '#/components/schemas/ContentBlock'
        model:
          $ref: '#/components/schemas/Model'
        stop_reason:
          $ref: '#/components/schemas/StopReason'
        stop_sequence:
          type: string
        usage:
          $ref: '#/components/schemas/Usage'
    CountTokensRequest:
      type: object
      required: [model, messages]
      properties:
        model:
          $ref: '#/components/schemas/Model'
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'
        system:
          type: string
        tools:
          type: array
          items:
            $ref: '#/components/schemas/Tool'
    CountTokensResponse:
      type: object
      required: [input_tokens]
      properties:
        input_tokens:
          type: integer
